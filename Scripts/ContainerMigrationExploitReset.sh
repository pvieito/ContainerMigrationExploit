#!/usr/bin/env bash

set -x

# Reset app-sandbox container:
rm -rf ~/Library/Containers/com.pvieito.ContainerMigrationExploitApp
rm -rf ~/Library/Containers/com.pvieito.MailContactsExploit

# Reset TCC permissions:
tccutil reset All com.pvieito.ContainerMigrationExpectedApp

# Create secret in Documents folder:
uuidgen > ~/Documents/my-secret.txt

# Backup & restore sensitive files:
cp ~/Library/Safari/History.db ~/Library/Safari/History.db.bak
cp ~/Library/Safari/History.db.bak ~/Library/Safari/History.db
cp ~/Library/Containers/com.apple.mail/Data/Library/Mail/V10/MailData/recentSearches.plist ~/Library/Containers/com.apple.mail/Data/Library/Mail/V10/MailData/recentSearches.plist.bak
cp ~/Library/Containers/com.apple.mail/Data/Library/Mail/V10/MailData/recentSearches.plist.bak ~/Library/Containers/com.apple.mail/Data/Library/Mail/V10/MailData/recentSearches.plist
cp ~/Library/Containers/com.apple.mail/Data/Library/Mail/V10/MailData/Envelope\ Index ~/Library/Containers/com.apple.mail/Data/Library/Mail/V10/MailData/Envelope\ Index.bak
cp ~/Library/Containers/com.apple.mail/Data/Library/Mail/V10/MailData/Envelope\ Index.bak ~/Library/Containers/com.apple.mail/Data/Library/Mail/V10/MailData/Envelope\ Index

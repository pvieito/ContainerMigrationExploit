#!/usr/bin/env bash

set -x

# Reset app-sandbox container:
rm -rf ~/Library/Containers/com.pvieito.ContainerMigrationExploitApp

# Reset TCC permissions:
tccutil reset All com.pvieito.ContainerMigrationExpectedApp

# Create secret in Documents folder:
uuidgen > ~/Documents/my-secret.txt

# Restore & backup sensitive files:
cp ~/Library/Safari/History.db.bak ~/Library/Safari/History.db
cp ~/Library/Safari/History.db ~/Library/Safari/History.db.bak
cp ~/Library/Calendars/Calendar.sqlitedb.bak ~/Library/Calendars/Calendar.sqlitedb
cp ~/Library/Calendars/Calendar.sqlitedb ~/Library/Calendars/Calendar.sqlitedb.bak
cp ~/Library/Containers/com.apple.mail/Data/Library/Mail/V10/MailData/recentSearches.plist.bak ~/Library/Containers/com.apple.mail/Data/Library/Mail/V10/MailData/recentSearches.plist
cp ~/Library/Containers/com.apple.mail/Data/Library/Mail/V10/MailData/recentSearches.plist ~/Library/Containers/com.apple.mail/Data/Library/Mail/V10/MailData/recentSearches.plist.bak
